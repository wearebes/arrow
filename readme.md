# 🎯 箭杆跳动检测

- 🧭 original.py：交互，首帧标定比例尺+单次画圆 ROI；灰度+高斯+Canny+霍夫圆（r±n）并按距离选最近圆。
- 🚀 arrow.py：增强交互（圆心/半径可拖拽多次调整），尺度标定支持拖端点/中点；限定搜索圈，候选圆按残差/距离综合选优并平滑追踪；带通频段可调，原始/滤波时域与频谱对比，轨迹图、慢速/预览、编码回退导出
  
### 主要功能
- 交互式标定比例尺：在首帧点击两点并输入实际距离，获得毫米/像素比例。
- 圆形 ROI 选取与可拖拽调整：指定待追踪的箭杆截面位置与半径。
- 自动圆心追踪与视频导出：在首帧 ROI 周围限定搜索圈，霍夫圆检测后按残差/距离选择最优圆，平滑追踪并生成带标记视频；可选慢速回放。
- 信号处理与频谱分析：对 X/Y/径向偏移做带通滤波，计算主频、均值、标准差、最大偏移等统计量。
- 滤波对比：同时输出原始与带通滤波后的 X/Y/径向时域曲线与频谱，便于对比噪声抑制效果。
- 结果可视化：时域曲线、频谱图、轨迹图（PNG）和处理后视频（MP4/AVI）。

### 环境依赖
- Python 3.11+
- 安装依赖：
```bash
pip install -r requirements.txt
```

### 步骤
1) 准备视频，将路径加入 `video_files`（位于 [arrow.py](arrow.py) 末尾 main 区域）。
2) 运行脚本：
```bash
python arrow.py
```
3) 首帧交互：
	- 标定比例尺：点击两点，按回车确认；随后输入两点间真实距离（mm）。如跳过，单位为像素。
	- 选取圆形 ROI：拖拽创建圆；可拖动圆心或边缘调整，回车确认。
4) 等待处理：脚本自动追踪圆心、滤波并输出视频、图表与统计结果。


### 输出内容
- 标记视频：带圆心与搜索圈的处理后视频，H.264 优先，失败则回退 MPEG-4/XVID。
- 慢速视频（可选）：根据 `slow_motion_factor` 保存。
- 轨迹图：`*_trajectory.png`，展示滤波后 XY 轨迹，包含起止点。
- 控制台统计：主频、均值、标准差、最大径向偏移、两两最大距离（原始/滤波）。

### 检测步骤
- test.ipynb 可以对于每个过程间有详细的检测展示

